# Assignment Module 3: Fuzzing and Coverag

### **Step 0: Pulling in Your Code**

```bash
git remote add upstream https://github.com/NYUAppSecCF/appsec_hw1_module2-YOURPART1REPO
git fetch upstream
git merge upstream/main --allow-unrelated-histories
git push
```

### **Step 1**
This section introduces key techniques for evaluating how well your test suite exercises your program and discovering potential vulnerabilities. You'll use *coverage analysis* and *fuzz testing* to expand the scope of your test suite and identify bugs. Each task builds on the work you've done in Module 1 and 2.

---

### **What Is Coverage?**
Coverage measures how much of your code is executed when running your test suite. It provides insights into which parts of your program are exercised by your tests and highlights areas that remain untested (uncovered).

#### Steps for Measuring Coverage:
1. Build `giftcardreader` with the `--coverage` option using `gcc`.
2. Run your test suite.
3. Use `lcov` to generate a coverage report.
   - Look up the hints for using `lcov` on BrightSpace.
   
#### Assignment Task:
1. Identify two lines of code that are *not covered* by your test suite.
2. Create new test cases (`cov1.gft` and `cov2.gft`) to cover these lines.
3. Add these new test cases to the correct `testcases/xxxx` directory.

---

### **What Is Fuzzing?**
Fuzzing is an automated testing technique where a program is executed with a wide variety of inputs (often randomly generated) to find bugs or vulnerabilities. In this assignment, you'll use AFL++ (a popular fuzzer) to fuzz the `giftcardreader`.

#### Steps for Fuzzing:
1. Install AFL++ and follow the [quick-start instructions](https://github.com/AFLplusplus/AFLplusplus#quick-start-fuzzing-with-afl).
2. Seed the fuzzer with your existing `.gft` test files (from Parts 1 and 2) by placing them in AFL's input directory.
3. Let the fuzzer run for at least two hours.
4. Analyze the outputs:
   - **Queue Directory**: Contains new test cases generated by AFL++.
   - **Crashes Directory**: Contains inputs that cause the program to crash.
   - **Hangs Directory**: Contains inputs that cause the program to hang.

#### Run the Gift Card Reader:
Use the following loop to run the `giftcardreader` on the test cases generated by AFL++:

```bash
for f in output/queue/id*; do ./giftcardreader 1 "$f"; done
```

---

### **Assignment Tasks**
1. **Coverage Improvements**:
   - After fuzzing, generate a new coverage report.
   - Verify that the fuzzer-generated test cases reach more parts of the program.
   
2. **Bug Fixing**:
   - Identify two crashes or hangs caused by fuzzer-generated test cases.
   - Fix the root causes of these issues.
   - Include the corresponding test cases (`fuzzer1.gft` and `fuzzer2.gft`) in your test suite to ensure these bugs don’t reappear.

3. **Writeup**:
   - Write a brief explanation in `part3.txt` describing:
     - The bugs found in this part.
     - The fixes you implemented.

---

### **Hints and Tips**
1. **Understanding Coverage**:
   - Coverage reports highlight untested code. Focus on creating targeted test cases for those areas.
   - Use `lcov` to visually inspect which lines remain uncovered.

2. **Fuzzer Optimization**:
   - Use a strong initial set of test cases to guide the fuzzer toward more valuable inputs.
   - Run the program with ASAN enabled (`make asan`) to detect subtle memory issues in the fuzzer-generated tests.

3. **Bug Identification**:
   - Use AddressSanitizer or debuggers like `gdb`/`lldb` to investigate crashes.
   - Reproducibility matters: If a crash isn’t consistent, refine your testing environment to stabilize it.

4. **Fuzzing Efficiency**:
   - Use at your own risk (advanced Fuzzing)
   - Keep fuzzer input/output directories inside the container (if using Docker) to improve speed.
   - For multi-core systems, run multiple fuzzer instances:
     ```bash
     afl-fuzz -i input -o output -M fuzzer1 ./giftcardreader 1 @@
     afl-fuzz -i input -o output -S fuzzer2 ./giftcardreader 1 @@
     afl-fuzz -i input -o output -S fuzzer3 ./giftcardreader 1 @@
     ```

---

### **Submission Instructions**
1. Commit the following to your repository:
   - Updated code.
   - Your created tests: `cov1.gft` and `cov2.gft`.
   - Fuzzer-generated tests: `fuzzer1.gft` and `fuzzer2.gft`.
   - Coverage report writeup: `part3.txt`.

2. Push your work with the following commands:

```bash
git tag -a -m "Completed hw1 part3." hw1p3handin
git push origin main
git push origin hw1p3handin
```

By following these steps, you’ll gain hands-on experience with coverage analysis, fuzz testing, and debugging—key skills in application security.
